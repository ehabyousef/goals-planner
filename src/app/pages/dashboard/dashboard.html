<div>
  <div class="flex w-full justify-between p-2 items-center">
    <div class="">
      <p class="text-5xl font-bold">Welcome Back {{ 'ehab' }}</p>
      <p class="text-xl my-2">you have compeleted 85% of your tasks</p>
    </div>
    <button
      hlmBtn
      variant="outline"
      size="sm"
      (click)="modalComponent.openDialog()"
      class="blueClass p-6 rounded-xl text-md font-bold flex items-center gap-2 text-white border-none"
    >
      <ng-icon hlm size="sm" name="lucidePlus" />
      <p>Create New Goal</p>
    </button>
  </div>
  <!-- cards of statics  -->
  <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-2 my-4">
    <div class="mx-auto w-full max-w-xl bg-white/10 dark:bg-white/5 backdrop-blur-md border border-white/20 shadow-lg p-4 rounded-xl">
      <div class="w-full flex justify-between items-center">
        <h2 class="text-2xl">Active Goals</h2>
        <ng-icon hlm size="xl" name="lucideFlag" />
      </div>
      <p class="text-5xl my-2">{{ goals().length }}</p>
    </div>
    <div class="mx-auto w-full max-w-xl bg-white/10 dark:bg-white/5 backdrop-blur-md border border-white/20 shadow-lg p-4 rounded-xl">
      <div class="w-full flex justify-between items-center">
        <h2 class="text-3xl">Tasks Compeleted</h2>
        <ng-icon hlm size="xl" name="lucideSquareCheckBig" />
      </div>
      <p class="text-3xl my-2">{{ AllTasks().length - Tasks().length }}/{{ AllTasks().length }}</p>
    </div>
    <div class="mx-auto w-full max-w-xl bg-white/10 dark:bg-white/5 backdrop-blur-md border border-white/20 shadow-lg p-4 rounded-xl">
      <div class="w-full flex justify-between items-center">
        <h2 class="text-2xl">Overall Progress</h2>
        <ng-icon hlm size="xl" name="lucideTrendingUp" />
      </div>
      <p class="text-xl font-bold my-2 text-end">45%</p>
      <div class="w-full bg-gray-200 rounded-full h-2">
        <div class="bg-blue-500 h-2 rounded-full" style="width: 45%"></div>
      </div>
    </div>
  </div>

  <!-- goals  -->
  <div class="w-full my-4 p-4 flex justify-between items-center">
    <h2 class="text-2xl font-bold">Active Goals</h2>
    <p routerLink="/goals" class="text-blue-500 cursor-pointer hover:underline">View All</p>
  </div>

  @if (isLoadingGoals()) {
    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 px-4">
      @for (i of [1, 2, 3]; track i) {
        <div class="rounded-xl shadow-xl overflow-hidden animate-pulse">
          <div class="h-60 bg-gray-300 dark:bg-gray-700"></div>
          <div class="p-4 space-y-3">
            <div class="h-4 bg-gray-300 dark:bg-gray-700 rounded w-3/4"></div>
            <div class="h-3 bg-gray-300 dark:bg-gray-700 rounded w-full"></div>
            <div class="h-3 bg-gray-300 dark:bg-gray-700 rounded w-5/6"></div>
            <div class="flex justify-between items-center">
              <div class="h-3 bg-gray-300 dark:bg-gray-700 rounded w-1/3"></div>
              <div class="h-3 bg-gray-300 dark:bg-gray-700 rounded w-1/4"></div>
            </div>
            <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2"></div>
          </div>
        </div>
      }
    </div>
  } @else if (goals().length === 0) {
    <div class="flex flex-col items-center justify-center py-16 px-4">
      <div class="text-center space-y-4">
        <div
          class="w-24 h-24 mx-auto bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center"
        >
          <ng-icon hlm name="lucideFlag" size="xl" class="text-gray-400 dark:text-gray-500" />
        </div>
        <h3 class="text-2xl font-semibold text-gray-700 dark:text-gray-300">No Active Goals</h3>
        <p class="text-gray-500 dark:text-gray-400">
          Start by creating your first goal to track your progress
        </p>
        <button
          hlmBtn
          (click)="modalComponent.openDialog()"
          class="blueClass px-6 py-2 rounded-xl text-md font-bold flex items-center gap-2 text-white border-none mx-auto mt-4"
        >
          <ng-icon hlm size="sm" name="lucidePlus" />
          <p>Create Your First Goal</p>
        </button>
      </div>
    </div>
  } @else {
    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 px-4">
      @for (item of goals(); track $index) {
        <div class="rounded-xl shadow-xl overflow-hidden bg-white/10 dark:bg-white/5 backdrop-blur-md border border-white/20">
          <div
            class="h-60 flex items-center justify-center relative cursor-pointer"
            [routerLink]="'/goals/' + item._id"
          >
            <img
              [src]="item.image?.url"
              alt="{{ item.title }}"
              class="w-full h-full object-cover rounded-sm"
            />
            <div class="absolute top-2 right-2 flex gap-2">
              <span
                class="px-2 py-1 text-xs font-semibold rounded-full"
                [ngClass]="{
                  'bg-red-100 text-red-700': item.priority === 'HIGH',
                  'bg-yellow-100 text-yellow-700': item.priority === 'MEDIUM',
                  'bg-green-100 text-green-700': item.priority === 'LOW',
                }"
              >
                {{ item.priority }}
              </span>
              <span
                class="px-2 py-1 text-xs font-semibold rounded-full"
                [ngClass]="{
                  'bg-blue-100 text-blue-700': item.status === 'ACTIVE',
                  'bg-green-100 text-green-700': item.status === 'COMPLETED',
                  'bg-gray-100 text-gray-700': item.status === 'ARCHIVED',
                }"
              >
                {{ item.status }}
              </span>
            </div>
          </div>
          <div class="p-4">
            <h3 class="text-lg font-bold">{{ item.title }}</h3>
            <p class="text-sm text-gray-600 line-clamp-2 my-2">
              {{ item.description }}
            </p>
            <div class="flex justify-between items-center my-2">
              <p class="text-sm text-gray-600">{{ item.progress_percent }}% Completed</p>
              <p class="text-sm text-blue-500 font-medium">
                {{ item.end_date | date: 'MMM yyyy' }}
              </p>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div
                class="bg-blue-500 h-2 rounded-full"
                [style.width.%]="item.progress_percent"
              ></div>
            </div>
          </div>
        </div>
      }
    </div>
  }

  <div class="w-full my-4 p-4 flex justify-between items-center">
    <h2 class="text-2xl font-bold">Active Tasks</h2>
    <p routerLink="/goals" class="text-blue-500 cursor-pointer hover:underline">View All</p>
  </div>

  @if (isLoadingTasks()) {
    <div class="flex flex-col gap-3 dark:bg-gray-950 bg-slate-200 p-4 rounded-md">
      <div class="flex items-center justify-center py-12">
        <hlm-spinner class="text-[2rem]" />
      </div>
    </div>
  } @else if (Tasks().length === 0) {
    <div
      class="flex flex-col items-center justify-center py-16 dark:bg-gray-950 bg-slate-200 rounded-md"
    >
      <div class="text-center space-y-4">
        <div
          class="w-24 h-24 mx-auto bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center"
        >
          <ng-icon
            hlm
            name="lucideSquareCheckBig"
            size="xl"
            class="text-gray-400 dark:text-gray-500"
          />
        </div>
        <h3 class="text-2xl font-semibold text-gray-700 dark:text-gray-300">No Active Tasks</h3>
        <p class="text-gray-500 dark:text-gray-400">All caught up! You have no tasks in progress</p>
      </div>
    </div>
  } @else {
    <div class="flex flex-col gap-3 bg-white/10 dark:bg-white/5 backdrop-blur-md border border-white/20 p-4 rounded-md">
      @for (item of Tasks(); track $index) {
        <div
          class="hover:bg-accent/50 flex items-start gap-3 rounded-lg border p-3 has-[[aria-checked=true]]:border-blue-600 has-[[aria-checked=true]]:bg-blue-200 dark:has-[[aria-checked=true]]:border-blue-900 dark:has-[[aria-checked=true]]:bg-blue-900"
        >
          <hlm-checkbox
            id="toggle-{{ $index }}"
            [checked]="item.status === 'DONE'"
            (checkedChange)="updateTask(item._id!)"
            class="data-[state=checked]:border-blue-600 data-[state=checked]:bg-blue-600 data-[state=checked]:text-white dark:data-[state=checked]:text-black border-blue-700"
          />
          <div class="grid gap-1.5 font-normal w-full">
            <div class="flex items-center justify-between">
              <p
                [ngClass]="{
                  'text-sm': true,
                  'leading-none': true,
                  'font-medium': true,
                  'line-through': item.status === 'DONE',
                  'text-muted-foreground': item.status === 'DONE',
                }"
              >
                {{ item.title }}
              </p>
              <span
                class="px-2 py-1 text-xs font-semibold rounded-full"
                [ngClass]="{
                  'bg-red-100 text-red-700': item.priority === 'HIGH',
                  'bg-yellow-100 text-yellow-700': item.priority === 'MEDIUM',
                  'bg-green-100 text-green-700': item.priority === 'LOW',
                }"
              >
                {{ item.priority }}
              </span>
            </div>
            <p class="text-muted-foreground text-sm line-clamp-2">
              {{ item.description }}
            </p>
            <div class="flex items-center justify-between text-xs text-muted-foreground">
              <span>Due: {{ item.end_date | date: 'MMM dd, yyyy' }}</span>
            </div>
          </div>
        </div>
      }
    </div>
  }

  <!-- tasks  -->
  <app-modal
    #modalComponent
    [title]="'Create New Goal'"
    [description]="'Fill in the details to create a new goal. Click save when you are done.'"
  />
</div>
